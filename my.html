<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Search</title>
</head>
<body>
    <h1>Song Search</h1>
    <form id="searchForm">
        <fieldset>
            <legend>Select Files</legend>
            <!-- Dynamically populate checkboxes with file names -->
            <div id="checkboxes"></div>
        </fieldset>
        <button type="button" onclick="searchSongs()">Search Songs</button>
    </form>
    <div id="results"></div>

    <script>
        // Function to fetch file names from setlist/ directory
        async function fetchFileNames() {
            const response = await fetch('setlist/');
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const files = Array.from(doc.querySelectorAll('a')).map(a => a.textContent.trim());
            return files.filter(file => file.endsWith('.txt'));
        }

        // Function to populate checkboxes with file names
        async function populateCheckboxes() {
            const files = await fetchFileNames();
            const checkboxesDiv = document.getElementById('checkboxes');
            files.forEach(file => {
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = 'file';
                checkbox.value = file;
                const label = document.createElement('label');
                label.textContent = file;
                label.appendChild(checkbox);
                checkboxesDiv.appendChild(label);
                checkboxesDiv.appendChild(document.createElement('br'));
            });
        }

        // Function to search songs based on selected checkboxes
        async function searchSongs() {
            const form = document.getElementById('searchForm');
            const checkboxes = form.querySelectorAll('input[type="checkbox"]:checked');
            const selectedFiles = Array.from(checkboxes).map(checkbox => checkbox.value);
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = ''; // Clear previous results

            for (const file of selectedFiles) {
                const response = await fetch(`setlist/${file}`);
                const text = await response.text();
                const lines = text.split('\n');
                const songFile = lines[1].trim(); // Assuming the second line contains the song.txt file name

                const songResponse = await fetch(`setlist/${songFile}`);
                const songText = await songResponse.text();
                const songs = songText.trim().split(',');

                const table = document.createElement('table');
                const headerRow = document.createElement('tr');
                const fileHeader = document.createElement('th');
                fileHeader.textContent = file;
                headerRow.appendChild(fileHeader);
                const songHeader = document.createElement('th');
                songHeader.textContent = 'Song';
                headerRow.appendChild(songHeader);
                table.appendChild(headerRow);

                for (const song of songs) {
                    const row = document.createElement('tr');
                    const cell1 = document.createElement('td');
                    cell1.textContent = song;
                    row.appendChild(cell1);
                    const cell2 = document.createElement('td');
                    const exists = lines.some(line => line.startsWith(song.trim()));
                    cell2.textContent = exists ? 'Yes' : 'No';
                    row.appendChild(cell2);
                    table.appendChild(row);
                }

                resultsDiv.appendChild(table);
            }
        }

        // Populate checkboxes on page load
        populateCheckboxes();
    </script>
</body>
</html>
