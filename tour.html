<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>セットリスト</title>
</head>
<body>

<select id="searchTerm">
  <option value="小倉唯">小倉唯</option>
  <option value="KING SUPER LIVE">KING SUPER LIVE</option>
  <option value="Animelo Summer Live">Animelo Summer Live</option>
  <option value="ANIMAX MUSIX">ANIMAX MUSIX</option>
</select>

<div id="setlistContainer"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchTermSelect = document.getElementById('searchTerm');
    const setlistContainer = document.getElementById('setlistContainer');

    // Function to fetch and display setlist
    function fetchAndDisplaySetlist(searchTerm) {
        fetch('setlist/')
            .then(response => response.text())
            .then(data => {
                const fileList = data.split('\n');
                let promises = [];
                fileList.forEach(file => {
                    if (file !== '') {
                        promises.push(
                            fetch(`setlist/${file}`)
                                .then(response => response.text())
                                .then(content => {
                                    if (content.includes(searchTerm)) {
                                        setlistContainer.innerHTML += `<p><strong>${file}</strong></p>`;
                                        setlistContainer.innerHTML += `<pre>${content}</pre>`;
                                    }
                                })
                                .catch(error => console.error('Error fetching setlist:', error))
                        );
                    }
                });
                Promise.all(promises)
                    .then(() => {
                        if (setlistContainer.innerHTML === '') {
                            setlistContainer.innerHTML = `<p>No setlists found containing "${searchTerm}"</p>`;
                        }
                    });
            })
            .catch(error => {
                console.error('Error fetching setlist:', error);
                setlistContainer.innerHTML = '<p>Error fetching setlist. Please try again later.</p>';
            });
    }

    // Event listener for select change
    searchTermSelect.addEventListener('change', function() {
        const selectedValue = searchTermSelect.value;
        setlistContainer.innerHTML = ''; // Clear previous results
        fetchAndDisplaySetlist(selectedValue);
    });

    // Initial fetch and display setlist
    const initialSelectedValue = searchTermSelect.value;
    fetchAndDisplaySetlist(initialSelectedValue);
});
</script>

</body>
</html>
