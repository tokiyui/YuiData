<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Search</title>
<style>
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid black;
        padding: 8px;
        text-align: left;
    }
    .checkbox-group label {
        display: inline-block;
        margin-right: 10px;
    }
</style>
</head>
<body>
<h2>Event Search</h2>
<div id="checkboxes">
</div>

<button onclick="searchEvents()">Search</button>

<table id="eventsTable">
    <thead>
        <tr>
            <th>Year</th>
            <th>Month</th>
            <th>Day of the week</th>
            <th>Type 1</th>
            <th>Type 2</th>
            <th>Type 3</th>
            <th>Title</th>
            <th>Event Title</th>
            <th>Prefecture</th>
            <th>Place</th>
            <th>With</th>
            <th>Info</th>
        </tr>
    </thead>
    <tbody id="eventsTableBody">
    </tbody>
</table>

<script>
function generateCheckboxes(id, options) {
    const container = document.getElementById('checkboxes');
    options.forEach(option => {
        const label = document.createElement('label');
        label.setAttribute('for', option);
        label.textContent = option;
        const checkbox = document.createElement('input');
        checkbox.setAttribute('type', 'checkbox');
        checkbox.setAttribute('name', id + '-' + option);
        checkbox.setAttribute('value', option);
        container.appendChild(checkbox);
        container.appendChild(label);
    });
}

generateCheckboxes('years', ['2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024']);
generateCheckboxes('months', ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12']);
generateCheckboxes('daysOfWeek', ['日', '月', '火', '水', '木', '金', '土']);

// Add checkboxes for type1, type2, type3, title, prefecture dynamically
fetch('data.txt')
    .then(response => response.text())
    .then(data => {
        const events = data.trim().split('\n').map(line => line.split(','));
        const headers = events.shift(); // Remove header row
        const type1Index = headers.indexOf('type1');
        const type2Index = headers.indexOf('type2');
        const type3Index = headers.indexOf('type3');
        const titleIndex = headers.indexOf('title');
        const eventTitleIndex = headers.indexOf('eventtitle');
        const prefectureIndex = headers.indexOf('prefecture');

        const type1Values = new Set();
        const type2Values = new Set();
        const type3Values = new Set();
        const titleValues = new Set();
        const eventTitleValues = new Set();
        const prefectureValues = new Set();

        events.forEach(event => {
            type1Values.add(event[type1Index]);
            type2Values.add(event[type2Index]);
            type3Values.add(event[type3Index]);
            titleValues.add(event[titleIndex]);
            eventTitleValues.add(event[eventTitleIndex]);
            prefectureValues.add(event[prefectureIndex]);
        });

        generateCheckboxes('type1', Array.from(type1Values));
        generateCheckboxes('type2', Array.from(type2Values));
        generateCheckboxes('type3', Array.from(type3Values));
        generateCheckboxes('title', Array.from(titleValues));
        generateCheckboxes('eventtitle', Array.from(eventTitleValues));
        generateCheckboxes('prefecture', Array.from(prefectureValues));
    })
    .catch(error => console.error('Error fetching data:', error));

function searchEvents() {
    const years = Array.from(document.querySelectorAll('input[name="years"]:checked')).map(input => input.value);
    const months = Array.from(document.querySelectorAll('input[name="months"]:checked')).map(input => input.value);
    const daysOfWeek = Array.from(document.querySelectorAll('input[name="daysOfWeek"]:checked')).map(input => input.value);
    const type1Values = Array.from(document.querySelectorAll('input[name="type1"]:checked')).map(input => input.value);
    const type2Values = Array.from(document.querySelectorAll('input[name="type2"]:checked')).map(input => input.value);
    const type3Values = Array.from(document.querySelectorAll('input[name="type3"]:checked')).map(input => input.value);
    const titleValues = Array.from(document.querySelectorAll('input[name="title"]:checked')).map(input => input.value);
    const eventTitleValues = Array.from(document.querySelectorAll('input[name="eventtitle"]:checked')).map(input => input.value);
    const prefectureValues = Array.from(document.querySelectorAll('input[name="prefecture"]:checked')).map(input => input.value);

    fetch('data.txt')
        .then(response => response.text())
        .then(data => {
            const events = data.trim().split('\n').map(line => line.split(','));
            const filteredEvents = events.filter(event => {
                const year = event[0];
                const month = event[1];
                const dayOfWeek = event[2]; // 修正：正しい列のインデックスを使用する
                const type1 = event[3]; // 修正：正しい列のインデックスを使用する
                const type2 = event[4]; // 修正：正しい列のインデックスを使用する
                const type3 = event[5]; // 修正：正しい列のインデックスを使用する
                const title = event[6]; // 修正：正しい列のインデックスを使用する
                const eventTitle = event[7]; // 修正：正しい列のインデックスを使用する
                const prefecture = event[8]; // 修正：正しい列のインデックスを使用する
                return (
                    (years.length === 0 || years.includes(year)) &&
                    (months.length === 0 || months.includes(month)) &&
                    (daysOfWeek.length === 0 || daysOfWeek.includes(dayOfWeek)) &&
                    (type1Values.length === 0 || type1Values.includes(type1)) &&
                    (type2Values.length === 0 || type2Values.includes(type2)) &&
                    (type3Values.length === 0 || type3Values.includes(type3)) &&
                    (titleValues.length === 0 || titleValues.includes(title)) &&
                    (eventTitleValues.length === 0 || eventTitleValues.includes(eventTitle)) &&
                    (prefectureValues.length === 0 || prefectureValues.includes(prefecture))
                );
            });

            displayEvents(filteredEvents);
        })
        .catch(error => console.error('Error fetching data:', error));
}

function displayEvents(events) {
    const tableBody = document.getElementById('eventsTableBody');
    tableBody.innerHTML = '';
    
    events.forEach(event => {
        const row = document.createElement('tr');
        event.forEach(value => {
            const cell = document.createElement('td');
            cell.textContent = value;
            row.appendChild(cell);
        });
        tableBody.appendChild(row);
    });
}
</script>
</body>
</html>
