<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setlist</title>
</head>
<body>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get the 10-digit number from the URL
    const urlParams = new URLSearchParams(window.location.search);
    const concertID = urlParams.get('id');

    // Fetch the setlist file
    fetch(`setlist/${concertID}.txt`)
        .then(response => response.text())
        .then(data => {
            const lines = data.split('\n');
            const date = lines[0].trim(); // Date line
            const title = lines[1].trim(); // Title line
            const venue = lines[2].trim(); // Venue line

            // Display date in the specified format
            const formattedDate = new Date(date).toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
            document.body.innerHTML += `<p>${formattedDate}</p>`;

            // Display title in bold
            document.body.innerHTML += `<p><strong>${title}</strong></p>`;

            // Display venue
            document.body.innerHTML += `<p>@${venue}</p>`;

            // Process setlist
            let isEncore = false;
            let isMedley = false;
            let encoreCount = 0; // Track the number of encore songs
            let medleyCount = 0; // Track the number of medleys
            let prevSongWasMedley = false; // Track if previous song was part of a medley
            for (let i = 4; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line === '<MEDLEY>') {
                    isMedley = true;
                    medleyCount++; // Increment medley count
                    document.body.innerHTML += `<p>Medley ${medleyCount}:</p>`;
                    prevSongWasMedley = true; // Set flag indicating previous song was part of a medley
                } else if (line === '<MEDLEY END>') {
                    isMedley = false;
                } else if (line === '<ENCORE>') {
                    isEncore = true;
                    encoreCount = 0; // Reset encore song count when new encore starts
                    document.body.innerHTML += '<p>Encore:</p>';
                    prevSongWasMedley = false; // Reset flag when new encore starts
                } else if (line === '<W ENCORE>') {
                    document.body.innerHTML += '<p>Double Encore:</p>';
                    prevSongWasMedley = false; // Reset flag when new encore starts
                } else if (line === '<FANCLUB>') {
                    document.body.innerHTML += '<p>Fanclub Exclusive:</p>';
                    prevSongWasMedley = false; // Reset flag when new fanclub exclusive starts
                } else {
                    if (line !== '') { // Check if line is not empty
                        if (isMedley) {
                            // Display medley song only if it's not empty
                            document.body.innerHTML += `<p style="margin-left: 20px;">${line}</p>`;
                        } else {
                            let prefix = isEncore ? 'EC' : '';
                            if (prevSongWasMedley) {
                                // If previous song was part of a medley, continue numbering sequentially
                                encoreCount++;
                            } else {
                                // Otherwise, start new sequence
                                encoreCount = 1;
                            }
                            document.body.innerHTML += `<p>${prefix}${encoreCount}. ${line}</p>`;
                            prevSongWasMedley = isMedley; // Update flag based on current song
                        }
                    }
                }
            }
        })
        .catch(error => {
            console.error('Error fetching setlist:', error);
            document.body.innerHTML = '<p>Error fetching setlist. Please try again later.</p>';
        });
});
</script>

</body>
</html>
