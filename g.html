<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>セットリスト</title>
<style>
table {
  border-collapse: collapse;
  width: auto; /* Width set to auto for dynamic resizing */
}

table, th, td {
  border: 1px solid black;
}

th, td {
  padding: 8px;
  text-align: left;
}

th {
  background-color: #f2f2f2;
}
</style>
</head>
<body>

<table id="setlistTable">
  <thead>
    <tr>
      <th>日付</th>
      <th>タイトル</th>
      <th>会場</th>
      <!-- Concert options will be added dynamically here -->
    </tr>
  </thead>
  <tbody id="setlistBody">
    <!-- Setlist data will be filled dynamically here -->
  </tbody>
</table>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const setlistTable = document.getElementById('setlistTable');
    const setlistBody = document.getElementById('setlistBody');

    // Fetch setlist options on page load
    fetchSetlistOptions()
        .then(options => {
            const concertOptionsHTML = options.map(option => `<option value="${option}">${option}</option>`).join('');
            setlistTable.getElementsByTagName('tr')[0].innerHTML += `<th><select id="concertSelector">${concertOptionsHTML}</select></th>`;

            const concertSelector = document.getElementById('concertSelector');
            concertSelector.addEventListener('change', function() {
                const selectedConcert = this.value;

                // Fetch the setlist for the selected concert
                fetchSetlist(selectedConcert)
                    .then(data => {
                        setlistBody.innerHTML = data;
                    })
                    .catch(error => {
                        console.error('Error fetching setlist:', error);
                        setlistBody.innerHTML = '<tr><td colspan="4">Error fetching setlist. Please try again later.</td></tr>';
                    });
            });
        })
        .catch(error => {
            console.error('Error fetching setlist options:', error);
        });

    function fetchSetlistOptions() {
        return fetch(`https://api.github.com/repos/tokiyui/YuiData/contents/setlist`)
            .then(response => response.json())
            .then(files => {
                const options = files
                    .filter(file => file.type === 'file' && file.name.endsWith('.txt'))
                    .map(file => file.name.replace('.txt', ''));
                return options;
            });
    }

    function fetchSetlist(selectedConcert) {
        return fetch(`https://api.github.com/repos/tokiyui/YuiData/contents/setlist/${selectedConcert}.txt`)
            .then(response => response.text())
            .then(data => {
                return parseSetlist(data);
            });
    }

    function parseSetlist(setlistData) {
        const lines = setlistData.split('\n');
        let setlistHTML = '';

        const date = lines[0].trim(); // Date line
        const title = lines[1].trim(); // Title line
        const venue = lines[2].trim(); // Venue line

        setlistHTML += `<tr><td>${date}</td><td>${title}</td><td>${venue}</td><td>`;
        for (let i = 3; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line !== '') {
                setlistHTML += `${line}<br>`;
            }
        }
        setlistHTML += `</td></tr>`;

        return setlistHTML;
    }
});
</script>

</body>
</html>
