<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>セットリスト</title>
<style>
table {
  border-collapse: collapse;
  width: 100%;
}

table, th, td {
  border: 1px solid black;
}

th, td {
  padding: 8px;
  text-align: left;
}

th {
  background-color: #f2f2f2;
}
</style>
</head>
<body>

<select id="concertSelector">
  <option value="HAPPY JAM">小倉唯 1st LIVE「HAPPY JAM」</option>
  <option value="High-Touch☆Summer">小倉唯 1st LIVE TOUR「High-Touch☆Summer」</option>
  <option value="Smiley Cherry">小倉唯 LIVE「Smiley Cherry」</option>
  <option value="Platinum Airline☆">小倉唯 2nd LIVE TOUR「Platinum Airline☆」</option>
  <option value="Step Apple">小倉唯 LIVE TOUR 2019「Step Apple」</option>
  <option value="#Re♥LOVEcall">小倉唯 LIVE 2021「#Re♥LOVEcall」</option>
  <option value="Memorial LIVE 2023 ~To the 11'Eleven~">小倉唯 Memorial LIVE 2023 ~To the 11'Eleven~</option>
  <option value="Memorial LIVE 2023 ~10th Anniversary Assemble!!~">小倉唯 Memorial LIVE 2023 ~10th Anniversary Assemble!!~</option>
  <option value="KING SUPER LIVE">KING SUPER LIVE</option>
  <option value="Animelo Summer Live">Animelo Summer Live</option>
  <option value="ANIMAX MUSIX">ANIMAX MUSIX</option>
</select>

<table id="setlistTable">
  <thead>
    <tr id="headerRow">
      <!-- ヘッダー行 -->
    </tr>
  </thead>
  <tbody id="setlistBody">
    <!-- セットリストの内容 -->
  </tbody>
</table>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const concertSelector = document.getElementById('concertSelector');
    const setlistTable = document.getElementById('setlistTable');
    const headerRow = document.getElementById('headerRow');

    concertSelector.addEventListener('change', function() {
        const selectedConcert = this.value;

        // Fetch the setlist files
        fetchSetlist(selectedConcert)
            .then(data => {
                const concerts = Object.keys(data);
                // Set header row
                headerRow.innerHTML = '';
                concerts.forEach(concert => {
                    const th = document.createElement('th');
                    th.textContent = concert;
                    headerRow.appendChild(th);
                });

                // Populate setlist data
                setlistTable.innerHTML = '';
                const dates = Object.values(data);
                dates.forEach(dateData => {
                    const tr = document.createElement('tr');
                    concerts.forEach(concert => {
                        const td = document.createElement('td');
                        if (dateData[concert]) {
                            td.innerHTML = dateData[concert];
                        } else {
                            td.textContent = '-';
                        }
                        tr.appendChild(td);
                    });
                    setlistTable.appendChild(tr);
                });
            })
            .catch(error => {
                console.error('Error fetching setlist:', error);
                setlistTable.innerHTML = '<tbody><tr><td colspan="4">Error fetching setlist. Please try again later.</td></tr></tbody>';
            });
    });

    function fetchSetlist(selectedConcert) {
        return fetch(`https://api.github.com/repos/tokiyui/YuiData/contents/setlist`)
            .then(response => response.json())
            .then(files => {
                const setlistData = {};
                const setlistPromises = [];
                files.forEach(file => {
                    if (file.type === 'file' && file.name.endsWith('.txt')) {
                        const setlistPromise = fetch(`setlist/${file.name}`)
                            .then(response => response.text())
                            .then(data => {
                                const concerts = parseSetlist(file.name, data);
                                setlistData[file.name] = concerts;
                            })
                            .catch(error => {
                                console.error('Error fetching setlist file:', error);
                            });
                        setlistPromises.push(setlistPromise);
                    }
                });
                return Promise.all(setlistPromises)
                    .then(() => setlistData);
            });
    }

    function parseSetlist(fileName, setlistData) {
        const lines = setlistData.split('\n');
        const concerts = {};
        const date = lines[0].trim();
        concerts['Date'] = date;
        for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line.startsWith('#')) {
                const concertName = line.substring(1);
                let setlist = '';
                i++;
                while (i < lines.length && !lines[i].startsWith('#')) {
                    setlist += lines[i] + '<br>';
                    i++;
                }
                concerts[concertName] = setlist;
                i--; // Decrease i to correctly handle the next line in the outer loop
            }
        }
        return concerts;
    }
});
</script>

</body>
</html>
