<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>セットリスト</title>
<style>
table {
  border-collapse: collapse;
  width: 100%;
}

table, th, td {
  border: 1px solid black;
}

th, td {
  padding: 8px;
  text-align: left;
}

th {
  background-color: #f2f2f2;
}
</style>
</head>
<body>

<table id="setlistTable">
  <tbody id="setlistBody">
  </tbody>
</table>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const setlistTable = document.getElementById('setlistTable');

    fetchSetlists()
        .then(setlists => {
            const dates = setlists.map(setlist => setlist.date);
            const titles = setlists.map(setlist => setlist.title);
            const venues = setlists.map(setlist => setlist.venue);
            const setlistsData = setlists.map(setlist => setlist.setlist);

            const datesRow = createRow(dates);
            const titlesRow = createRow(titles);
            const venuesRow = createRow(venues);
            const setlistsRow = createRow(setlistsData);

            setlistTable.innerHTML += datesRow + titlesRow + venuesRow + setlistsRow;
        })
        .catch(error => {
            console.error('Error fetching setlists:', error);
            setlistTable.innerHTML = '<tbody><tr><td colspan="3">Error fetching setlists. Please try again later.</td></tr></tbody>';
        });

function fetchSetlists() {
    return fetch(`https://api.github.com/repos/tokiyui/YuiData/contents/setlist`)
        .then(response => response.json())
        .then(files => {
            const setlistPromises = [];
            files.forEach(file => {
                if (file.type === 'file' && file.name.endsWith('.txt')) {
                    const setlistPromise = fetch(`setlist/${file.name}`)
                        .then(response => response.text())
                        .then(data => {
                            const setlist = parseSetlist(file.name, data);
                            return setlist;
                        })
                        .catch(error => {
                            console.error('Error fetching setlist file:', error);
                            return null;
                        });
                    setlistPromises.push(setlistPromise);
                }
            });
            return Promise.all(setlistPromises)
                .then(setlists => setlists.filter(setlist => setlist !== null));
        });
}

function parseSetlist(fileName, setlistData) {
    const lines = setlistData.split('\n');
    const date = lines[0].trim();
    const title = lines[1].trim();
    const venue = lines[2].trim();
    const setlist = lines.slice(3).map(line => line.trim()).join('<br>');
    return { date, title, venue, setlist };
}

function createRow(data) {
    let row = '<tr>';
    data.forEach(item => {
        row += `<td>${item}</td>`;
    });
    row += '</tr>';
    return row;
}
});
</script>

</body>
</html>
