<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>セットリスト</title>
</head>
<body>

<div id="setlistContainer"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const setlistContainer = document.getElementById('setlistContainer');
    // 選択されたコンサートのリスト
    const selectedConcerts = ['HAPPY JAM', 'High-Touch☆Summer', 'Smiley Cherry']; // 例としていくつかのコンサートを追加

    // 各コンサートのセットリストを取得し、setlistContainerに追加
    selectedConcerts.forEach(concert => {
        fetchSetlist(concert)
            .then(data => {
                setlistContainer.innerHTML += data;
            })
            .catch(error => {
                console.error('Error fetching setlist:', error);
                setlistContainer.innerHTML += '<p>Error fetching setlist for ' + concert + '. Please try again later.</p>';
            });
    });

    function fetchSetlist(selectedConcert) {
        return fetch(`https://api.github.com/repos/tokiyui/YuiData/contents/setlist`)
            .then(response => response.json())
            .then(files => {
                let setlistHTML = ''; // 各公演のセットリストを保持する変数

                files.forEach(file => {
                    if (file.type === 'file' && file.name.endsWith('.txt')) {
                        fetch(`setlist/${file.name}`)
                            .then(response => response.text())
                            .then(data => {
                                if (data.includes(selectedConcert)) {
                                    setlistHTML += parseSetlist(data);
                                }
                            })
                            .catch(error => {
                                console.error('Error fetching setlist file:', error);
                                setlistHTML += '<p>Error fetching setlist. Please try again later.</p>';
                            });
                    }
                });
                return setlistHTML;
            });
    }

    function parseSetlist(setlistData) {
        const lines = setlistData.split('\n');
        let setlistHTML = '';

        const date = lines[0].trim(); // Date line
        const title = lines[1].trim(); // Title line
        const venue = lines[2].trim(); // Venue line

        setlistHTML += `<p>日付: ${date}</p>`;
        setlistHTML += `<p>タイトル: ${title}</p>`;
        setlistHTML += `<p>会場: ${venue}</p>`;
        setlistHTML += `<p>セットリスト:</p>`;
        for (let i = 3; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line !== '') {
                setlistHTML += `<p>${line}</p>`;
            }
        }

        return setlistHTML;
    }
});
</script>

</body>
</html>
